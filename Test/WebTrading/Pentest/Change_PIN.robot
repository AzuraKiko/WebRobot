*** Settings ***
Resource    ../../../Page/WebTrading/Pentest/Change_PIN.robot
Resource    ../../../Utils/API.robot


*** Variables ***
${username1}    autotest3@equix.com.au
${username2}    autotest@equix.com.au
${username3}    autotest2@equix.com.au
${pin}          111111
${new_pin}      222222


*** Test Cases ***
Check access right
    [Tags]    pentest
    Open Enter Current Pin Popup
    Verify popup Enter Current Pin display

Check Input current PIN. Input correct PIN
    [Tags]    pentest
    Input Current PIN    ${pin}
    Verify popup New Pin display

Check Input current PIN. Input incorrect PIN - 1st time
    [Tags]    pentest
    Click button Back
    Input Current PIN    123456
    Verify message error current Pin    1 Failed PIN Attempt

Check Input current PIN. Input incorrect PIN - 2nd time
    [Tags]    pentest
    Input Current PIN    123456
    Verify message error current Pin    2 Failed PIN Attempts

Check Input current PIN. Input incorrect PIN - 3rd time
    [Tags]    pentest
    Input Current PIN    123456
    Verify message Confirm Bound    You have been automatically signed out for security reasons
    Click button OK in popup Confirm Bound
    Verify link [Sign In] display
    Close Browser

Check Send Code button
    [Tags]    pentest
    Login and enter PIN successfully Web Trading    ${username2}    ${password}    ${pin}
    Click icon Setting
    Click option Change PIN
    Input Current PIN    ${pin}
    Input New PIN    ${new_pin}
    Input Confirm New PIN1    ${new_pin}
    Click button [Send Code]
    Wait button [Send Code] disable
    Verify button [Send Code] disable in time    60

Check Confirm button. Input incorrect PIN - 1st time
    [Tags]    pentest
    Input textbox Enter Code    123456
    Click button Confirm
    Verify message Error Code    Incorrect verification code. Please retry again

Check Confirm button. Input incorrect PIN - 2nd time
    [Tags]    pentest
    Wait button [Confirm] enable
    Click button Confirm
    Verify button [Confirm] disable in time    10
    Verify message Error Code    You have tried too many times. Please try again later.

Check Confirm button. Input incorrect PIN - 3rd time
    [Tags]    pentest
    Wait button [Confirm] enable
    Click button Confirm
    Verify button [Confirm] disable in time    20
    Verify message Error Code    You have tried too many times. Please try again later.

Check Confirm button. Input incorrect PIN - 4th time
    [Tags]    pentest
    Wait button [Confirm] enable
    Click button Confirm
    Verify button [Confirm] disable in time    120
    Verify message Error Code    You have tried too many times. Please try again later.

Check Confirm button. Input incorrect PIN - 5th time
    [Tags]    pentest
    Wait button [Confirm] enable
    Click button Confirm
    Verify message Error Code
    ...    Your username has been temporarily blocked for security reason. Please contact hello@equix.app for support.
    API set status of user    2

# New test cases

Check PIN validation - Special characters
    [Tags]    pentest
    Open Enter Current Pin Popup
    Input Current PIN    !@#$%^
    Verify message error current Pin    PIN must contain only numbers

Check PIN validation - Less than 6 digits
    [Tags]    pentest
    Input Current PIN    12345
    Verify message error current Pin    PIN must be 6 digits

Check PIN validation - More than 6 digits
    [Tags]    pentest
    Input Current PIN    1234567
    Verify message error current Pin    PIN must be 6 digits

Check PIN validation - Sequential numbers
    [Tags]    pentest
    Input Current PIN    123456
    Verify message error current Pin    PIN cannot be sequential numbers

Check PIN validation - Repeating numbers
    [Tags]    pentest
    Input Current PIN    111111
    Verify message error current Pin    PIN cannot be repeating numbers

Check PIN validation - Same as current PIN
    [Tags]    pentest
    Input Current PIN    ${pin}
    Input New PIN    ${pin}
    Input Confirm New PIN1    ${pin}
    Verify message error current Pin    New PIN cannot be the same as current PIN

Check PIN validation - Network timeout
    [Tags]    pentest
    Input Current PIN    ${pin}
    Simulate Network Timeout
    Verify message error current Pin    Network timeout. Please try again

Check PIN validation - Session expiry
    [Tags]    pentest
    Input Current PIN    ${pin}
    Simulate Session Expiry
    Verify message error current Pin    Your session has expired. Please login again

Check PIN validation - Concurrent sessions
    [Tags]    pentest
    Open Enter Current Pin Popup
    Open Second Session
    Input Current PIN    ${pin}
    Verify message error current Pin    Another session is active. Please close other sessions first
