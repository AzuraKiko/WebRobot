*** Settings ***
Resource    ../../../Page/WebTrading/Pentest/Forgot_PIN.robot


*** Test Cases ***
# Password Confirmation Flow
Check UI "Enter Your New" screen
    [Tags]    pentest
    Open Forgot PIN Popup
    Click Forgot PIN
    Input textbox Password to confirm    ${password}
    Click OK Button
    Verify popup New Pin display
    Verify button [Next] disable
    Verify button [Cancel] enable

Check incorrect password confirmation. Incorrect 1st time
    [Tags]    pentest
    Open Forgot PIN Popup
    Verify popup Reset PIN display
    Input textbox Password to confirm    123123123
    Click OK Button
    Verify error message Password in Reset PIN screen    Incorrect Password

Check incorrect password confirmation. Incorrect 2nd times
    [Tags]    pentest
    Click OK Button
    Verify Error Setting    You have tried too many times. Please try again later.
    Verify OK Button Disabled With Timeout    300s

Check incorrect password confirmation. Incorrect 3rd times
    [Tags]    pentest
    Wait button OK enable
    Click OK Button
    Verify Error Setting    You have tried too many times. Please try again later.
    Verify OK Button Disabled With Timeout    900s

Check incorrect password confirmation. Incorrect 4th times
    [Tags]    pentest
    Wait button OK enable
    Click OK Button
    Verify Error Setting    You have tried too many times. Please try again later.
    Verify OK Button Disabled With Timeout    1800s

Check incorrect password confirmation. Incorrect 5th times
    [Tags]    pentest
    Wait button OK enable
    Click OK Button
    Verify Error Setting
    ...    Your username has been temporarily blocked for security reason. Please contact hello@equix.app for support.
    Close Browser
    ${token}=    Get Authentication Token
    ...    ${urlLogin}
    ...    ${other_username}
    ...    ${other_password}
    ...    ${origin}
    ...    ${version}
    ...    ${environment}
    Update User Status    ${user_id}    2    ${token}

# Cancel Button Functionality

Check cancel button. when not count down
    [Tags]    pentest
    Click button Cancel
    Verify popup Reset PIN display
    Click button Cancel
    Verify popup Enter PIN display

Check cancel button. When count down
    [Tags]    pentest
    Click Forgot PIN
    Input textbox Password to confirm    111111
    Click OK Button
    Input textbox Password to confirm    111111
    Click OK Button
    Click button Cancel
    Verify popup Enter PIN display
    Close Browser

# New PIN Entry Flow

Check input same old PIN
    [Tags]    pentest
    Open Forgot PIN Popup
    Click Forgot PIN
    Input textbox Password to confirm    ${password}
    Click OK Button
    Verify popup New Pin display
    Input PIN    ${pin}
    Input Confirm PIN    ${pin}
    Verify popup Confirm New PIN display

Check input PIN which different from old PIN
    [Tags]    pentest
    Click button [Back]
    Input Confirm PIN    121212
    Verify popup Confirm New PIN display

Check function in New PIN screen. Check Cancel button/ Check Next Button
    [Tags]    pentest
    Click button [Back]
    Click button Cancel
    Verify popup Reset PIN display
    Input textbox Password to confirm    ${password}
    Click OK Button
    Input Confirm PIN    ${pin}
    Verify popup Confirm New PIN display
    Click button [Back]
    Verify popup New Pin display
    Click button [Next]
    Verify popup Confirm New PIN display

# PIN Confirmation Flow

Check UI "Confirm Your New PIN" screen. Check default loading
    [Tags]    pentest
    Verify button [Back] enable
    Verify button [Next] disable

Check Confirm PIN. Check input confirmation PIN different new PIN
    [Tags]    pentest
    Input Confirm New PIN    121212
    Verify message error Confirm PIN    PIN did not match. Try again

Check Confirm PIN. Check input confirmation PIN different new PIN x many times/ Check disapears error msg
    [Tags]    pentest
    Input Confirm New PIN    121212
    Verify message error Confirm PIN    PIN did not match. Try again
    Input Confirm New PIN    121212
    Verify message error Confirm PIN    PIN did not match. Try again
    Input Confirm New PIN    121212
    Verify message error Confirm PIN    PIN did not match. Try again

Check Confirm PIN. Check confirm PIN successfully
    [Tags]    pentest
    Input Confirm New PIN    ${pin}
    Verify OTP screen display

Check function of "Confirm Your New PIN" screen. Check Next button
    [Tags]    pentest
    Click button [Back]
    Click button [Next]
    Verify OTP screen display

# OTP Verification Flow

Check UI OPT screen. Check UI default loading
    [Tags]    pentest
    Verify button [Back] enable
    Verify button [Send Code] enable
    Verify text placeholder textbox input code    Enter 6 Digit Code
    Verify button [Confirm] disable

Check function. Click on Back button
    [Tags]    pentest
    Click button [Back]
    Verify popup Confirm New PIN display

Check function. Click on Send Code button
    [Tags]    pentest
    Click button [Done]
    Verify button [Send Code] disable
    Verify button [Send Code] disable in time    60

Check validate OPT textbox. Check input special character/ Check input string type
    [Tags]    pentest
    Input textbox Enter Code    !@#$%^%
    Verify textbox Enter Code receive characters    ${EMPTY}
    Input textbox Enter Code    ABCdef
    Verify textbox Enter Code receive characters    ${EMPTY}

Check confirm button. Check input incorrect OPT 1st time
    [Tags]    pentest
    ${number}=    Random number    6
    Input textbox Enter Code    ${number}
    Click button Confirm
    Verify message Error Code    Incorrect verification code. Please retry again

Check confirm button. Check input incorrect OPT 2nd time
    [Tags]    pentest
    Wait button [Confirm] enable
    Click button Confirm
    Verify button [Confirm] disable in time    300s
    Verify message Error Code    You have tried too many times. Please try again later.

Check confirm button. Check input incorrect OPT 3rd time
    [Tags]    pentest
    Wait button [Confirm] enable
    Click button Confirm
    Verify button [Confirm] disable in time    900s
    Verify message Error Code    You have tried too many times. Please try again later.

Check confirm button. Check input incorrect OPT 4th time
    [Tags]    pentest
    Wait button [Confirm] enable
    Click button Confirm
    Verify button [Confirm] disable in time    1800s
    Verify message Error Code    You have tried too many times. Please try again later.

Check confirm button. Check input incorrect OPT 5th time
    [Tags]    pentest
    Wait button [Confirm] enable
    Click button Confirm
    Verify message Error Code
    ...    Your username has been temporarily blocked for security reason. Please contact hello@equix.app for support.
    Close Browser
    ${token}=    Get Authentication Token
    ...    ${urlLogin}
    ...    ${other_username}
    ...    ${other_password}
    ...    ${origin}
    ...    ${version}
    ...    ${environment}
    Update User Status    ${user_id}    2    ${token}
