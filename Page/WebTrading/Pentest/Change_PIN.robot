*** Settings ***
Resource    ../../../Page/WebTrading/Pentest/LoginPage.robot
Resource    Change_Pass.robot


*** Variables ***
${option_ChangePin}                 //*[text()='Change PIN']
${header_Enter_Current_Pin}         //*[@class="header size--4"][text()='Enter Your Current PIN']
${textbox_Enter_Current_PIN}        (//*[@class="pinFormInput"])[1]//*[contains(@class,"symbolPrivatePinCode")]
${error_PIN}                        (//*[contains(@class,"pinFormAlert")])[1]
${btnCancel}                        //*[@class="button match undefined"][text()='cancel']

${popup_Enter_New_PIN}              //*[@class="header size--4"][text()='Enter Your New PIN']
${button_Back}                      //*[@class="button match undefined"][text()='back']
${link_Sign_In}                     //*[@class="loginBtnHeader showTitle text-capitalize"]
${textbox_Enter_New_PIN}            (//*[@class="pinFormInput"])[2]//*[contains(@class,"symbolPrivatePinCode")]

${popup_Confirm_New_Pin}            //*[@class="header size--4"][text()='Confirm Your New PIN']
${textbox_Enter_Confirm_New_PIN}    (//*[@class="pinFormInput"])[3]//*[contains(@class,"symbolPrivatePinCode")]
${button_Send_Code}                 ((//input[@name="code"]//following-sibling::div)[2]//div)[1]

${button_Confirm}                   ((//*[@placeholder="Enter 6 Digit Code"]//following-sibling::div)[2]//div)[2]
${textbox_Enter_Code}               //input[@name="code"]
${error_Code}                       (//*[@name="code"]//following-sibling::div)[1]//*[@class="pinFormAlert size--3"]


*** Keywords ***
Click option Change PIN
    Click To Element    ${option_ChangePin}

Open Enter Current Pin Popup
    Login And Input Pin    ${username}    ${password}
    Click icon Setting
    Hover To Security
    Click option Change PIN

Verify popup Enter Current Pin display
    Verify element display    ${header_Enter_Current_Pin}

Verify popup New Pin display
    Wait Until Element Is Visible    ${popup_Enter_New_PIN}
    Element Should Be Visible    ${popup_Enter_New_PIN}

Verify popup Confirm New Pin display
    Wait Until Element Is Visible    ${popup_Confirm_New_Pin}
    Element Should Be Visible    ${popup_Confirm_New_Pin}

Input Current PIN
    [Arguments]    ${pin}
    Wait Until Element Is Visible    ${textbox_Enter_Current_PIN}    ${time}
    Clear PIN Field
    Press Keys    ${None}    ${pin}

Clear PIN Field
    # Count elements with the specified XPath
    ${elements}=    Get WebElements    ${textbox_Enter_Current_PIN}
    ${length}=    Get Length    ${elements}

    # Only clear if there are elements to clear
    IF    ${length} > 0
        FOR    ${i}    IN RANGE    ${length}
            Click Element    ${keyBoardDel}
        END
    END

Input New PIN
    [Arguments]    ${pin}
    Wait Until Element Is Visible    ${textbox_Enter_New_PIN}    ${time}
    Clear PIN Field
    Press Keys    ${None}    ${pin}

Input Confirm New PIN
    [Arguments]    ${pin}
    Wait Until Element Is Visible    ${textbox_Enter_Confirm_New_PIN}    ${time}
    Clear PIN Field
    Press Keys    ${None}    ${pin}

Verify button [Cancel] enable
    Verify button enable    ${button_Cancel}

Click button Back
    Click To Element    ${button_Back}

Verify message error PIN
    [Arguments]    ${text_Expected}
    Verify message    ${error_PIN}    ${text_Expected}

Verify message error match PIN
    [Arguments]    ${text_Expected}
    Verify Flash Error Message    ${error_PIN}    ${text_Expected}

Verify link [Sign In] display
    Verify element display    ${link_Sign_In}

Verify button [Send Code] enable
    Verify button disable/enable by JS    ${button_Send_Code}    pointer

Click button [Send Code]
    Click To Element    ${button_Send_Code}

Wait button [Send Code] disable
    Wait button disable by JS    ${button_Send_Code}

Verify button [Send Code] disable in time
    [Arguments]    ${timeblock}
    Verify button disable in time    ${button_Send_Code}    ${timeblock}

Input textbox Enter Code
    [Arguments]    ${code}
    Clear And Input Text To Element    ${textbox_Enter_Code}    ${code}

Click button Confirm
    Click To Element    ${button_Confirm}

Verify message Error Code
    [Arguments]    ${text_Expected}
    Verify message display slowly    ${error_Code}    ${text_Expected}

Wait button [Confirm] enable
    Wait Button Enable By Text    ${button_Confirm}    Confirm

Verify button [Confirm] disable
    Verify button disable/enable by JS    ${button_Confirm}    not-allowed

Verify button [Confirm] disable in time
    [Arguments]    ${timeblock}
    Wait button disable by JS    ${button_Confirm}
    Verify button disable in time    ${button_Confirm}    ${timeblock}
