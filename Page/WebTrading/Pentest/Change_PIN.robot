*** Settings ***
Resource    ../../../Page/WebTrading/Pentest/LoginPage.robot
Resource    Change_Pass.robot
Resource    ../../../Utils/Common.robot


*** Variables ***
${option_ChangePin}             //*[text()='Change PIN']
${header_Enter_Current_Pin}     //*[@class="header size--4"][text()='Enter Your Current PIN']
${textbox_Enter_Current_PIN}    (//*[@class="pinFormInput"])[1]//*[contains(@class,"symbolPrivatePinCode")]
${popup_Enter_New_PIN}          //*[@class="header size--4"][text()='Enter Your New PIN']
${button_Back}                  //*[@class="button match undefined"][text()='back']
${error_Curren_PIN}             (//*[contains(@class,"pinFormAlert size--3 ")])[1]
${link_Sign_In}                 //*[@class="loginBtnHeader showTitle text-capitalize"]
${textbox_Enter_New_PIN}        (//*[@class="pinFormInput"])[2]//*[contains(@class,"symbolPrivatePinCode")]
${button_Send_Code}             //*[@id="sendCodeButton"]
${key_Delete_New_Pin}           //*[contains(@class,"pinFormRoot fadeInAnimation ")]//*[@fill="var(--secondary-default)"]
${button_OK}                    //*[@class="btn size--4"][text()='OK']
${button_Confirm}               //*[@id="confirmButton"]
${textbox_Enter_Code}           //*[@id="verificationCodeInput"]
${error_Code}                   //*[@class="verificationCodeAlert"]


*** Keywords ***
Click option Change PIN
    Click To Element    ${option_ChangePin}

Open Enter Current Pin Popup
    Login And Input Pin    ${username}    ${password}
    Click icon Setting
    Hover To Security
    Click option Change PIN

Verify popup Enter Current Pin display
    Verify element display    ${header_Enter_Current_Pin}

Verify popup New Pin display
    Wait Until Element Is Visible    ${popup_Enter_New_PIN}
    Element Should Be Visible    ${popup_Enter_New_PIN}

Input Current PIN
    [Arguments]    ${pin_number}
    FOR    ${i}    IN RANGE    6
        Click To Element    ${keyBoard${pin_number}}
    END
    Press Keys    ${None}    ${pin_number}

Input New PIN
    [Arguments]    ${character}
    Wait Until Element Is Visible    ${textbox_Enter_New_PIN}    20s
    sleep    1s
    FOR    ${i}    IN RANGE    0    6
        Click To Element    ${key_Delete_New_Pin}
    END
    Press Keys    ${None}    ${character}

Input Confirm New PIN1
    [Arguments]    ${character}
    Wait Until Element Is Visible    ${textbox_Enter_New_PIN}    20s
    sleep    1s
    FOR    ${i}    IN RANGE    0    6
        Click To Element    ${key_Delete_New_Pin}
    END
    Press Keys    ${None}    ${character}

Click button Back
    Click To Element    ${button_Back}

Click button OK in popup Confirm Bound
    Click To Element    ${button_OK}

Verify message error current Pin
    [Arguments]    ${text_Expected}
    Wait Until Element Is Visible    ${error_Curren_PIN}    timeout=30s
    sleep    1s
    ${text_Actual}=    Get Text    ${error_Curren_PIN}
    Should Be Equal    ${text_Expected}    ${text_Actual}

Verify link [Sign In] display
    Verify element display    ${link_Sign_In}

Click button [Send Code]
    Click To Element    ${button_Send_Code}

Wait button [Send Code] disable
    Wait button disable by JS    ${button_Send_Code}

Verify button [Send Code] disable in time
    [Arguments]    ${time}
    Wait Until Element Is Not Visible    ${button_Send_Code}    timeout=${time}s

Input textbox Enter Code
    [Arguments]    ${code}
    Input Text    ${textbox_Enter_Code}    ${code}

Click button Confirm
    Click To Element    ${button_Confirm}

Verify message Error Code
    [Arguments]    ${text_Expected}
    Wait Until Element Is Visible    ${error_Code}    timeout=30s
    ${text_Actual}=    Get Text    ${error_Code}
    Should Be Equal    ${text_Expected}    ${text_Actual}

Wait button [Confirm] enable
    Wait Until Element Is Visible    ${button_Confirm}    timeout=30s
    Wait Until Element Is Enabled    ${button_Confirm}    timeout=30s

Verify button [Confirm] disable in time
    [Arguments]    ${time}
    Wait Until Element Is Not Visible    ${button_Confirm}    timeout=${time}s

Simulate Network Timeout
    Execute JavaScript    window.performance.setResourceTimingBufferSize(0)
    Sleep    5s
    Execute JavaScript    window.performance.setResourceTimingBufferSize(250)

Simulate Session Expiry
    Execute JavaScript    localStorage.clear()
    Execute JavaScript    sessionStorage.clear()
    Reload Page

Open Second Session
    Execute JavaScript    window.open('${URL}', '_blank')
    Switch Window    NEW
    Maximize Browser Window
