*** Settings ***
Resource        ../../../Locator/LoginLocator.robot
Resource        ../../../Utils/Common.robot
Resource        ../../../Page/WebTrading/Pentest/Create_PIN.robot
Variables       ../../../data/Env.py

*** Variables ***
${popup_Confirm_New_Pin}                //*[@class="header size--4"][text()='Confirm Your New PIN']
${textbox_Confirm_New_Pin}              (//*[@class="pinFormInput"])[3]//*[contains(@class,"symbolPrivatePinCode")]
${button_Send_Code}                     ((//input[@name="code"]//following-sibling::div)[2]//div)[1]
${button_Confirm}                       ((//*[@placeholder="Enter 6 Digit Code"]//following-sibling::div)[2]//div)[2]
${textbox_Input_Code}                   //input[@name="code"]
${icon_Loading}                         (//*[contains(@class,'btn size--4')])[2]//*[@src="common/Spinner-white.svg"]
${mess_Erros_Pass}                      //*[@class="incorrectText text-capitalize"]
${button_OK}                            (//*[contains(@class,'btn size--4')])[2]
${error_Setting}                        //*[@class="errorSetting error"]
${popup_Enter_New_Pin}                  //*[@class="header size--4"][text()='Enter Your New PIN']
${popup_OTP}                            //*[@class="header size--4"][text()='Confirm OTP']
${mess_Error_Code}                      (//*[@name="code"]//following-sibling::div)[1]//*[@class="pinFormAlert size--3"]
${key_Delete_New_Pin1}                  (//*[contains(@class,"pinFormRoot fadeInAnimation ")]//*[@fill="var(--secondary-default)"])[2]
${key_Delete_New_Pin2}                  //*[contains(@class,"pinFormRoot fadeInAnimation ")]//*[@fill="var(--secondary-default)"]

*** Keywords ***
Verify popup Confirm New PIN display
    Verify element display      ${popup_Confirm_New_Pin}

Input Confirm New PIN
    [Arguments]     ${character}
    Wait Until Element Is Visible    ${textbox_Confirm_New_Pin}    20s
    sleep  1s
    FOR    ${i}    IN RANGE    0    6
        Click To Element    ${key_Delete_New_Pin1}
    END
    Press Keys    ${None}    ${character}

Input Confirm New PIN1
    [Arguments]     ${character}
    Wait Until Element Is Visible    ${textbox_Confirm_New_Pin}    20s
    sleep  1s
    FOR    ${i}    IN RANGE    0    6
        Click To Element    ${key_Delete_New_Pin2}
    END
    Press Keys    ${None}    ${character}

Verify button [Cancel] enable
    Verify button enable       ${button_Cancel}

Verify button [Send Code] enable
    Verify button disable/enable by JS      ${button_Send_Code}       pointer

Verify button [Confirm] disable
    Verify button disable/enable by JS      ${button_Confirm}       not-allowed

Input textbox Password to confirm
    [Arguments]     ${text}
    Input Text To Element    ${textbox_Pass_Pin}    ${text}

Input textbox Enter Code
    [Arguments]     ${text}
    Input Text To Element    ${textbox_Input_Code}    ${text}

Verify error message Password in Reset PIN screen
    [Arguments]         ${text_Expected}
    Wait Until Element Is Not Visible    ${icon_Loading}
    Wait Until Element Is Visible    ${mess_Erros_Pass}
    ${text_Actual}=     Get Text    ${mess_Erros_Pass}
    Should Be Equal    ${text_Expected}    ${text_Actual}

Click button OK
    Click To Element   ${button_OK}

Click button Cancel
    Click To Element   ${button_Cancel}

Click button Confirm
    Click To Element   ${button_Confirm}

Verify Error Setting
    [Arguments]     ${text_Expected}
    Wait Until Element Is Visible    ${error_Setting}
    ${text_Actual}=     Get Text    ${error_Setting}
    Should Be Equal    ${text_Actual}    ${text_Expected}

Verify button OK disable in time
    [Arguments]     ${expectedTime}
    Wait Until Element Is Not Visible    ${icon_Loading}
    ${text}=        Get Text    ${button_OK}
    Should Be Equal    ${expectedTime}s    ${text}
    Wait Until Element Is Not Visible    ${error_Setting}

Wait button OK enable
    FOR    ${i}    IN RANGE    100
        ${text}=        Get Text    ${button_OK}
        Exit For Loop If    '${text}'=='OK'
        Sleep    5s
    END

Verify Enter New PIN screen display
    Verify element display      ${popup_Enter_New_Pin}

Verify OTP screen display
    Verify element display      ${popup_OTP}

Verify text placeholder textbox input code
    [Arguments]     ${text_Expected}
    Wait Until Element Is Visible         ${textbox_Input_Code}
    ${text_Actual}=     Get Element Attribute    ${textbox_Input_Code}      placeholder
    Should Be Equal    ${text_Expected}    ${text_Actual}

Verify textbox Enter Code receive characters
    [Arguments]     ${text_Expected}
    Wait Until Element Is Visible    ${textbox_Input_Code}
    ${text_Actual}=     Get Element Attribute    ${textbox_Input_Code}      value
    Should Be Equal    ${text_Expected}    ${text_Actual}

Verify button [Send Code] disable in time
    [Arguments]     ${time_Expected}
    Verify button disable in time       ${button_Send_Code}         ${time_Expected}

Verify button disable in time
    [Arguments]     ${button}   ${time_Expected}
    Wait Until Element Is Visible    ${button}
    ${time_Actual}=     Get Text    ${button}
    Should Be Equal    ${time_Expected}s    ${time_Actual}

Verify button [Confirm] disable in time
    [Arguments]     ${time_Expected}
    Wait Until Element Is Visible    ${button_Confirm}
    Wait Until Element Is Not Visible    ${icon_Loading}
    FOR    ${i}    IN RANGE    1000
        ${value}=   Execute Javascript     return window.getComputedStyle(document.evaluate(`${button_Confirm}`, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue,null).getPropertyValue("cursor");
        Exit For Loop If        '${value}'=='not-allowed'
    END
    ${time_Actual}=     Get Text    ${button_Confirm}
    Should Be Equal    ${time_Expected}s    ${time_Actual}

Verify button [Send Code] disable
    Wait Until Element Is Visible    ${button_Send_Code}
    FOR    ${i}    IN RANGE    1000
        ${value}=   Execute Javascript     return window.getComputedStyle(document.evaluate(`${button_Send_Code}`, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue,null).getPropertyValue("cursor");
        Exit For Loop If        '${value}'=='not-allowed'
    END
    Should Be Equal     ${value}        not-allowed

Wait button [Send Code] enable
    Wait Until Element Is Visible    ${button_Send_Code}
    FOR    ${i}    IN RANGE    100
        ${time_Actual}=     Get Text    ${button_Send_Code}
         Exit For Loop If    '${time_Actual}'=='Send Code'
         Sleep    5s
    END

Wait button [Confirm] enable
    Wait Until Element Is Visible    ${button_Confirm}
    FOR    ${i}    IN RANGE    100000
        ${time_Actual}=     Get Text    ${button_Confirm}
        Exit For Loop If    '${time_Actual}'=='Confirm'
        sleep    2s
    END
    Wait button enable by JS        ${button_Confirm}

Verify message Error Code
    [Arguments]     ${text_Expected}
    Wait Until Element Is Visible    ${mess_Error_Code}
    FOR    ${i}    IN RANGE    1000
        ${text_Actual}=     Get Text    ${mess_Error_Code}
        Exit For Loop If    '${text_Actual}'=='${text_Expected}'
    END
    Should Be Equal    ${text_Actual}    ${text_Expected}

Input Confirm PIN menu right
    [Arguments]     ${character}
    Wait Until Element Is Visible    ${textbox_Confirm_Pin}    20s
    sleep  1s
    FOR    ${i}    IN RANGE    0    6
        Click To Element    ${key_Delete_New_Pin1}
    END
    Press Keys    ${None}    ${character}