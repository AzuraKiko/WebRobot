*** Settings ***
Resource        ../../../Locator/LoginLocator.robot
Resource        ../../../Utils/Common.robot
Resource        ../../../Page/WebTrading/Pentest/Forgot_PIN.robot

*** Variables ***
${link_Forgot_Pass}                         //*[text()='forgot password?']
${header_Forgot_Pass}                       //*[text()='Please enter your email below and click send code to reset your password']
${textbox_Email}                            //*[@type="username"]
${mess_Error_Email}                         ((//*[@type="username"]//following::div)[4]//div)[1]//div
${mess_Error_Code}                          ((//*[@name="code"]//following::div)[4]//div)[1]//div
${button_Send_Code_Forgot_Pass}             (//*[@type="username"]//parent::div//following-sibling::div)[5]
${error_Mess_Forgot_Pass}                   //*[text()='Please enter your email below and click send code to reset your password']//preceding-sibling::div
${button_Confirm_Forgot_Pass}               //*[text()='cancel']//preceding-sibling::div

*** Keywords ***
Click link Forgot Password
    Click To Element    ${link_Forgot_Pass}
    
Verify popup Forgot Password display
    Verify element display      ${header_Forgot_Pass}

Verify placeholder of textbox Email
    Common.Verify text placeholder         ${textbox_Email}        Email *

Click header
    Click To Element    ${header_Forgot_Pass}

Verify mess require Email
    [Arguments]         ${mess_Expected}
    Verify message      ${mess_Error_Email}     ${mess_Expected}

Verify mess require Code
    [Arguments]         ${mess_Expected}
    Verify message      ${mess_Error_Code}     ${mess_Expected}

Verify button [Send code] in Popup Forgot Pass disable
    Verify button disable/enable by JS    ${button_Send_Code_Forgot_Pass}       not-allowed

Verify button [Send code] in Popup Forgot Pass enable
    Verify button disable/enable by JS    ${button_Send_Code_Forgot_Pass}       pointer

Input textbox Email in Popup Forgot Pass
    [Arguments]     ${text}
    Input Text To Element    ${textbox_Email}     ${text}

Click button [Send Code] in Popup Forgot Pass
    Click To Element    ${button_Send_Code_Forgot_Pass}

Click button [Confirm] in Popup Forgot Pass
    Click To Element    ${button_Confirm_Forgot_Pass}

Verify button [Send Code] in Popup Forgot Pass disable in time
    [Arguments]     ${expected_Time}
    Wait button disable by JS      ${button_Send_Code_Forgot_Pass}
    ${text}=        Get Text    ${button_Send_Code_Forgot_Pass}
    Should Be Equal    ${expected_Time}s    ${text}

Verify error message in popup Forgot Pass
    [Arguments]         ${mess_Expected}
    FOR    ${i}    IN RANGE    1000
        ${mess}=   Get Text     ${error_Mess_Forgot_Pass}
        Exit For Loop If        '${mess}'=='${mess_Expected}'
#        sleep        2s
    END
    Should Be Equal      ${mess}     ${mess_Expected}

Verify placeholder of textbox Enter Code
    Common.Verify text placeholder         ${textbox_Input_Code}        Enter 6 Digit Code *

Click textbox [Enter Code] in Popup Forgot Pass
    Click To Element    ${textbox_Input_Code}

Verify button [Confirm] in Popup Forgot Pass disable
    Wait Until Element Is Visible    ${button_Confirm_Forgot_Pass}
    ${value}=   Execute Javascript     return window.getComputedStyle(document.evaluate(`${button_Confirm_Forgot_Pass}`, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue,null).getPropertyValue("cursor");
    Should Not Contain     ${value}        pointer

Verify button [Confirm] in Popup Forgot Pass enable
    Verify button disable/enable by JS    ${button_Confirm_Forgot_Pass}        pointer

Verify button [Confirm] in Popup Forgot Pass disable in time
    [Arguments]     ${expected_Time}
    Wait button disable by JS      ${button_Confirm_Forgot_Pass}
    ${text}=        Get Text    ${button_Confirm_Forgot_Pass}
    Should Be Equal    ${expected_Time}s    ${text}

Wait button [Confirm] in Forgot Pass enable
    Wait button enable by JS      ${button_Confirm_Forgot_Pass}

Wait button [Send Code] in Forgot Pass enable
    Wait button enable by JS      ${button_Send_Code_Forgot_Pass}